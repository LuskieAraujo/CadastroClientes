@model List<ClienteModel>
@{
	ViewData["Title"] = "Clientes";
}

<div class="text-center">
	<div class="row">
		<div class="form-group offset-10 col-2">
			<a type="button" class="btn btn-light" asp-route-id="0" asp-controller="Cliente" asp-action="Cliente">Novo</a>
		</div>
	</div>
	<div class="row">
		<div class="form-group col-4">
			<div class="input-group">
				<label class="col-form-label col-3 text-right">Nome</label>
				<input class="col-9 form-control" type="text" id="txtNomeCliente" />
			</div>
		</div>
		<div class="form-group col-4">
			<div class="input-group">
				<label class="col-form-label col-4 text-right">Documento</label>
				<input class="col-9 form-control" type="text" id="txtDocumentoCliente" />
			</div>
		</div>
		<div class="form-group offset-1 col-3">
			<button id="btnFiltrar" type="button" class="btn btn-dark" asp-controller="Cliente" asp-action="Clientes">Filtrar</button>
			<a id="btnLimparFiltros" type="button" class="btn btn-light" asp-controller="Cliente" asp-action="Clientes">Limpar Filtros</a>
		</div>
	</div>

	<table class="table table-hover table-sm">
		<thead class="thead-dark">
			<tr>
				<th scope="col" class="col-1">#</th>
				<th scope="col" class="col-4">Nome</th>
				<th scope="col" class="col-2">Documento</th>
				<th scope="col" class="col-2">Telefone</th>
				<th scope="col" class="col-2">Ações</th>
			</tr>
		</thead>
		<tbody>
			@if (Model != null && Model.Any())
			{
				int contador = 0;
				foreach (var cli in Model)
				{
					contador++;
					<tr>
						<th scope="row">@contador</th>
						<td>@cli.Nome</td>
						<td>@cli.Documento</td>
						<td>@cli.Telefone</td>
						<td>
							<div class="btn-group" role="group">
								<a type="button" class="btn btn-sm btn-secondary" asp-route-id="@cli.Id" asp-controller="Cliente" asp-action="Cliente">Editar</a>
								<button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-nome="@cli.Nome" data-id="@cli.Id" data-target="#modalApagar">Apagar</button>
							</div>
						</td>
					</tr>
				}
			}
		</tbody>
	</table>
</div>

<div class="modal" tabindex="-1" role="dialog" id="modalApagar">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Deletar cliente</h5>
			</div>
			<div class="modal-body">
				<p>Deseja realmente deletar este cliente?</p>
				<label type="text" id="lblNome"></label>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Não</button>
				<button type="button" id="btnApagar" class="btn btn-sm btn-dark" asp-route-id="" asp-controller="" asp-action="">Sim</button>
			</div>
		</div>
	</div>
</div>
@section Scripts {
	<script>
		$(document).ready(function () {
			var campoNome = $('#txtNomeCliente');
			var campoDocumento = $('#txtDocumentoCliente');

			$('#modalApagar').on('show.bs.modal', function (event) {
				var id;
				var button = $(event.relatedTarget);
				var modal = $(this);

				id = button.data('id');
				document.getElementById('lblNome').innerHTML = button.data('nome');
				modal.find('#btnApagar').attr('asp-route-id', id);
			});

			$('#btnApagar').click(function () {
				$.ajax({
					type: "POST",
					url: "/Cliente/Excluir",
					data: { id: $('#btnApagar').attr('asp-route-id') },
					success: {

					}
				});
			});

			$('#btnFiltrar').click(function () {
				$.ajax({
					type: 'GET',
					url: "/Cliente/Clientes",
					contentType: "application/json",
					data: { nome: campoNome.val(), documento: campoDocumento.val() },
					success: {

					}
				});
			});
		});
	</script>
}

@* Regras:
O campo documento deve ter máscara e validação de acordo com o Tipo, ou seja, se no momento do cadastro o tipo selecionado for PF, o documento deve ter a máscara e validação de CPF, se o tipo selecionado for PJ o documento deve ter a máscara e validação de CNPJ.
A validação deve ser feita tanto no frontend quanto no backend. Na listagem de clientes deve ser possível filtrar os clientes por Nome e Documento. Deverá ser possível editar e remover os clientes cadastrados, no caso da remoção, deverá ser feito um soft delete. *@